# <a name="Service"></a> Сервис опросов

[Запуск приложения](#Start)

[Работа в панели администратора](#Admin)

+ [Авторизация в панели админа](#Login)
+ [Выход из панели админа](#Logout)
+ [Создание опроса](#CreatePoll)
+ [Обновление опроса](#UpdatePoll)
+ [Удаление опроса](#DeletePoll)
+ [Добавление вопросов](#CreateQuestions)
+ [Обновление вопроса](#UpdateQuestion)
+ [Удаление вопросов](#DeleteQuestions)

## <a name="Start"></a> Запуск приложения

1) Переходим в директорию /dev, где лежит файл *docker-compose.yaml* . В терминале выполняем команду **docker-compose up
   -d** (запуск СУБД).
2) Переходим в корневой каталог, где лежит файл *pom.xml*. В терминале выполняем команду **mvn clean install**. Ждем
   пока билд завершится. Liquibase накатывает нужные таблицы и заполняет их тестовыми данными.
3) Переходим в директорию /target, где лежит файл *qa-service-0.0.1-SNAPSHOT.jar*. В терминале выполняем команду java
   -jar qa-service-0.0.1-SNAPSHOT.jar. Приложение запустилось на локальной машине на порту 8080.
   
   [Назад](#Service)

## <a name="Admin"></a> Работа в панели администратора

#### <a name="Login"></a> 1) Реализована авторизация по логину и паролю с валидацией и проверкой в БД.

*POST http://localhost:8080/admin/login*:

```
{
    "login": "admin",
    "password": "aaddmmiin"
}
```

В случае удачной авторизации сессия администратора сохраняется до выхода (логаута). Админ имеет доступ к действиям
пользователя без прав, при этом обычный юзер не имеет возможности работать в панели администратора.

[Назад](#Service)

#### <a name="Logout"></a> 2) Успешный логаут возможен, только если пользователь до этого был авторизован как админ

*POST http://localhost:8080/admin/logout*

[Назад](#Service)

#### <a name="CreatePoll"></a> 3) Создание опроса

В теле запроса передаем название, описание и дату завершения опроса. Все поля должны быть заполнены (**null / ""**
значения не являются валидными). Дата окончания опроса может быть раньше текущей календарной даты. Такой опрос будем
считать неактивным.

*POST http://localhost:8080/admin/polls*

```
{
    "name": "Хороший опрос",
    "description": "Сделаем нормальный опрос",
    "endDate": "01/01/2027"
}
```

Успешный ответ - информация о созданном запросе:

```
{
    "pollId": 3,
    "name": "Хороший опрос",
    "endDate": "01.01.27 0:00",
    "description": "Сделаем нормальный опрос"
}
```

[Назад](#Service)

#### <a name="UpdatePoll"></a> 4) Обновление опроса

Тело запроса аналогично запросу при создании опроса, только отсутсвует валидация полей. Дата валидируется только
форматом dd/MM/yyyy.

*PATCH http://localhost:8080/admin/polls/{poolId}*

Пример: *PATCH http://localhost:8080/admin/polls/3*

```
{
    "name": "",
    "description": "Хах",
    "endDate": "13/13/2019"
}
```

Успешный ответ:

```
{
    "pollId": 3,
    "name": "",
    "endDate": "13.01.20 0:00",
    "description": "Хах"
}
```
[Назад](#Service)

#### <a name="DeletePoll"></a> 5) Удаление опроса

Удаляем запрос по его ID. Если опроса с таким ID нет, администратор будет уведомлен об этом.

*DELETE http://localhost:8080/admin/polls/{poolId}*

Пример: *DELETE http://localhost:8080/admin/polls/3*

Успешный ответ:

**Опрос с ID = 3 был удален**

Ошибка:

**Опрос с ID = 3 не существует!**

[Назад](#Service)

#### <a name="CreateQuestions"></a> 6) Создание списка вопросов

Можно добавлять вопросы по одному или списком, передавая ID опроса, для которого добавляем вопросы. В одном запросе доступно 
добавление вопросов только для одного опроса. Поля сущности валидируются. Также добавлена проверка на существование опроса с заданным ID

*POST http://localhost:8080/admin/questions?pollId*

Пример: *POST http://localhost:8080/admin/questions?pollId=4*

```
[
{
"content": "Есть три стула: 1 2 3",
"type": "MULTIPLE"
},
{
"content": "Есть один стул. Что с ним не так?",
"type": "SINGLE"
}
]
```

Успешный ответ:

```
[
    {
        "questionId": 5,
        "content": "Есть три стула: 1 2 3",
        "type": "Вопрос с несколькими вариантами ответа"
    },
    {
        "questionId": 6,
        "content": "Есть один стул. Что с ним не так?",
        "type": "Вопрос с одним вариантом ответа"
    }
]
```

Ошибка:

**Опрос с ID = 4 не существует!**

[Назад](#Service)

#### <a name="UpdateQuestion"></a> 7) Обновление вопроса

Вопросы можно исправлять по одному, а не списком как при создании. Передаём ID вопроса. Если поле сущности в теле запроса
= null, это поле не будет обновлено. Проверяется ID вопроса. Если вопроса с таким ID нет, то придет сообщение об ошибке.

*PATCH http://localhost:8080/admin/questions/{id}*

Пример: *PATCH http://localhost:8080/admin/questions/6*

```
{
    "content": null,
    "type": "TEXT"
}
```

Успешный ответ:

```
{
    "questionId": 6,
    "content": "Есть один стул. Что с ним не так?",
    "type": "Вопрос с развернутым ответом"
}
```

Ошибка:

**Вопрос с ID =7 не найден!**

[Назад](#Service)

#### <a name="DeleteQuestions"></a> 8) Удаление вопросов

Вопросы можно удалять по одному или списком по ID вопроса. Если вопроса с указанным ID не существует, придет сообщение с текстом 
исключения и транзакция откатится, ничего удалено не будет.

*DELETE http://localhost:8080/admin/questions/{ids}*

Пример: *DELETE http://localhost:8080/admin/questions/5,6*

Успешный ответ:

**Удаленные вопросы: [5, 6]**

Ошибка:

**No class com.example.qaservice.data.entity.Question entity with id 7 exists!**

[Назад](#Service)
